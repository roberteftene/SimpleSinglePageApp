<!DOCTYPE html>
<html>

<head>
    <title>Message list</title>
</head>

<body>
    <h1>Messages</h1>
</body>
<div id="content">
    <table id="tableData" style="width:100%;">
        <tr>
            <th>ID</th>
            <th>Subject</th>
            <th>Name</th>
            <th>Message</th>
            <th>Actions</th>
        </tr>
        <tr>
            <td>1</td>
            <td>Subject data</td>
            <td>Name data</td>
            <td>Message data</td>
            <td>
                <button>Edit</button>
                <button>Delete</button>
            </td>
        </tr>
    </table>

    <form onsubmit="saveMessage(event)">
        <input type="hidden" name="id" id="id" /><br />
        Name:<br />
        <input type="text" name="name" id="name" /><br />
        Subject:<br />
        <input type="text" name="subject" id="subject"><br />
        Message:<br />
        <textarea name="message" id="message"></textarea> <br />
        <input type="submit" value="Save message">
        <input type="reset" value="Cancel">
    </form>

    <script type="text/javascript">
        window.onload = () => {
            showMessages();
        }

        async function saveMessage(event) {

            event.preventDefault();
           
            let id = event.target.id.value

            let data = {
                name: event.target.name.value,
                subject: event.target.subject.value,
                message: event.target.message.value
            }

            let url = '';
            let method = ''

            if(id) {
                url = '/message' + id;
                method = 'PUT'
            } else {
                url = 'messages'
                method = 'POST'
            }

            try {

                let result = await fetch(url, {
                    method: method,
                    body: JSON.stringify(data),
                    headers: {
                        "Content-type": "application/json; charset=UTF-8"
                    }
                }).then(response => response.json())
                showMessages();
                event.target.name.value = ''
                event.target.subject.value = ''
                event.target.message.value = ''
            } catch (err) {
                console.log(err);   
            }
        }

        async function showMessages() {
            try {
                let result = await fetch('/messages').then(response => response.json())

                let html = `
                <table style="width:500px;">
                <tr>
                    <th>ID</th>
                    <th>Subject</th>
                    <th>Name</th> 
                    <th>Message</th>
                    <th>Actions</th>
                </tr>
                `
                result.forEach(element => {
                    html += `
                    <tr>
                        <td>${element.id}</td>
                        <td>${element.subject}</td>
                        <td>${element.name}</td>
                        <td>${element.message}</td>
                        <td>
                            <button onClick="editMessage(${element.id})">Edit</button>
                            <button onClick="deleteMessage(${element.id})">Delete</button>
                        </td>
                    </tr>
                    `
                });

                html += '</table>'
                document.getElementById('tableData').innerHTML = html;

            } catch (err) {
                console.log(err)
            }
        }
    </script>
</div>

</html>